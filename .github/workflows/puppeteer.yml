name: Puppeteer Tests
on: [push, pull_request]

# https://hub.docker.com/r/cypress/browsers/tags
jobs:
  test:
    runs-on: ubuntu-latest
    container: cypress/browsers:latest
    steps:
      - uses: actions/checkout@v4
      - run: npm i -g pnpm
      - run: pnpm install
      - name: Check available browsers
        run: |
          which google-chrome || which google-chrome-stable || which chromium-browser || echo "No Chrome found"
          ls -la /usr/bin/ | grep -i chrome || echo "No Chrome in /usr/bin/"
      - name: Install Chrome for Puppeteer
        run: |
          # Install Chrome using Puppeteer's browser installer
          npx puppeteer browsers install chrome
          echo "Chrome installation completed"
          # Verify installation
          ls -la ~/.cache/puppeteer/ || echo "Puppeteer cache not found"
      - name: Run Puppeteer tests
        run: pnpm run e2e
        env:
          CI: true
          PUPPETEER_SKIP_CHROMIUM_DOWNLOAD: false


